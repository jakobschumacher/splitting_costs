<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Costsplitter - Fair Cost Division</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="text-center mb-8">
            <div style="position: relative;">
                <h1 style="margin: 0 0 0.5rem 0;">Costsplitter</h1>
                <div style="position: absolute; top: 0; right: 0; display: flex; gap: 0.5rem;">
                    <button id="resetButton" class="btn" style="width: 2rem; height: 2rem; border-radius: 50%; padding: 0; font-size: 1rem; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">↻</button>
                    <button id="helpButton" class="btn" style="width: 2rem; height: 2rem; border-radius: 50%; padding: 0; font-size: 1rem; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">?</button>
                </div>
            </div>
            <p>Fair cost division for group travel</p>
            <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem;">Upload your expense CSV file to automatically calculate who owes what to whom. Supports individual payments and shared expenses with customizable split ratios.</p>
        </header>

        <!-- Step 1: Upload File -->
        <section id="step1" class="step-section">
            <div class="step-header">
                <span class="step-number">1</span>
                <h2>Upload Your CSV File</h2>
            </div>
            <div class="card">
                <div id="dropZone" class="drop-zone">
                    <!-- Default upload state -->
                    <div id="uploadDefaultState">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">⬆</div>
                        <h3>Drop your CSV file here or click to browse</h3>
                        <p style="color: #6b7280;">Supports files up to 10MB</p>
                    </div>

                    <!-- File uploaded state (hidden by default) -->
                    <div id="uploadedState" class="hidden">
                        <div style="font-size: 4rem; margin-bottom: 1rem; color: #059669;">✓</div>
                        <h3 style="color: #059669; margin-bottom: 0.5rem;">File uploaded successfully!</h3>
                        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0;">Ready to process <span id="uploadedFileNameBottom"></span></p>
                    </div>
                    <div id="csvHelp" class="hidden" style="margin-top: 1rem; padding: 1rem; background: #f0fdf4; border-radius: 0.375rem; border: 1px solid #bbf7d0; text-align: left;">
                        <h4 style="margin-top: 0; color: #047857;">CSV File Format</h4>
                        <p style="margin-bottom: 0.5rem; font-size: 0.875rem;">Your CSV should contain the following columns:</p>
                        <ul style="font-size: 0.875rem; margin: 0.5rem 0; padding-left: 1.5rem;">
                            <li><strong>activity</strong> - name of the expense/activity</li>
                            <li><strong>paidBy</strong> - person who paid for this expense</li>
                            <li><strong>amount</strong> - total amount paid (e.g., 25.50)</li>
                            <li><strong>participants</strong> - comma-separated list of people</li>
                            <li><strong>shares</strong> (optional) - custom shares per person (e.g., "2,1,1")</li>
                        </ul>
                        <p style="font-size: 0.875rem; margin-bottom: 0;">Example: <code style="background: #e5e7eb; padding: 0.125rem 0.25rem; border-radius: 0.25rem;">"Dinner,Alice,60.00,Alice,Bob,Charlie,2,1,1"</code></p>
                    </div>
                </div>
                <input type="file" id="csvFile" class="hidden" accept=".csv">

            </div>
        </section>

        <!-- Step 2: Configure & Process -->
        <section id="step2" class="step-section hidden">
            <div class="step-header">
                <span class="step-number">2</span>
                <h2>Configure Options & Process</h2>
            </div>
            <div class="card">
                <div class="space-y-4">
                    <div>
                        <label for="paymentMode">Payment Mode</label>
                        <select id="paymentMode">
                            <option value="individual">Individual</option>
                            <option value="group">Group</option>
                        </select>
                    </div>
                    <div class="flex space-x-3">
                        <button id="processButton" class="btn btn-primary">Process File</button>
                    </div>
                </div>

                <!-- Horizontal Progress Steps -->
                <div id="progressSteps" class="hidden" style="margin-top: 2rem;">
                    <h3 id="progressTitle" style="margin-bottom: 1rem;">Processing Your File</h3>
                    <div class="progress-horizontal">
                        <div class="progress-step-horizontal" data-step="parsing">
                            <div class="progress-icon">⚙</div>
                            <div class="progress-label">Parsing</div>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step-horizontal" data-step="security">
                            <div class="progress-icon">⚿</div>
                            <div class="progress-label">Security</div>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step-horizontal" data-step="validation">
                            <div class="progress-icon">✓</div>
                            <div class="progress-label">Validation</div>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step-horizontal" data-step="transformation">
                            <div class="progress-icon">↔</div>
                            <div class="progress-label">Transform</div>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step-horizontal" data-step="calculation">
                            <div class="progress-icon">∑</div>
                            <div class="progress-label">Calculate</div>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step-horizontal" data-step="reporting">
                            <div class="progress-icon">※</div>
                            <div class="progress-label">Report</div>
                        </div>
                    </div>
                </div>

                <!-- Loading Display -->
                <div id="loadingDisplay" class="hidden text-center" style="padding: 2rem;">
                    <div class="spinner"></div>
                    <p style="margin-top: 0.5rem; color: #6b7280;">Processing your file...</p>
                </div>

                <!-- Error Display -->
                <div id="errorDisplay" class="hidden" style="margin-top: 2rem; padding: 1rem; border-radius: 0.375rem; border: 1px solid #fecaca; background: #fef2f2;"></div>
            </div>
        </section>

        <!-- Step 3: Results -->
        <section id="step3" class="step-section hidden">
            <div class="step-header">
                <span class="step-number">3</span>
                <h2>Results</h2>
            </div>
            <div class="card">
                <div class="grid grid-4" id="summaryContent">
                    <!-- Summary cards will be inserted here -->
                </div>

                <div class="space-y-4" style="margin-top: 2rem;">
                    <div>
                        <h3>Payment Instructions</h3>
                        <div id="instructionsContent" class="instructions-box">
                            <!-- Instructions will be inserted here -->
                        </div>
                    </div>

                    <div>
                        <h3>Payment Matrix</h3>
                        <div id="matrixContent" class="overflow-x-auto">
                            <!-- Matrix table will be inserted here -->
                        </div>
                    </div>

                    <div>
                        <h3>Activity Breakdown</h3>
                        <div id="activitiesContent" class="grid grid-3">
                            <!-- Activities will be inserted here -->
                        </div>
                    </div>

                <div style="margin-top: 2rem; text-align: center;">
                    <button id="downloadPdfButton" class="btn btn-primary">Download PDF Report</button>
                </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>